# docker-compose.yml - 开发和部署配置
version: "3.8"

services:
  # 基于 Ubuntu 的开发环境
  dev-ubuntu:
    build:
      context: .
      dockerfile: Dockerfile.optimized.ubuntu
    container_name: ossapp-dev-ubuntu
    ports:
      - "2022:2022"
    volumes:
      # - ubuntu-dev-data:/home/ossapp
      - ./workspace:/home/ossapp/workspace
    environment:
      - USER_NAME=ossapp
      - SSH_PORT=2022
    restart: unless-stopped
    networks:
      - dev-network

  # 基于 Alpine 的轻量环境
  dev-alpine:
    build:
      context: .
      dockerfile: Dockerfile.optimized.alpine
    container_name: ossapp-dev-alpine
    ports:
      - "2023:2022"
    volumes:
      # - alpine-dev-data:/home/ossapp
      - ./workspace:/home/ossapp/workspace
    environment:
      - USER_NAME=ossapp
      - SSH_PORT=2022
    restart: unless-stopped
    networks:
      - dev-network

  # 多阶段构建环境
  dev-multistage:
    build:
      context: .
      dockerfile: Dockerfile.optimized.multistage
    container_name: ossapp-dev-multistage
    ports:
      - "2024:2022"
    volumes:
      # - multistage-dev-data:/home/ossapp
      - ./workspace:/home/ossapp/workspace
    environment:
      - USER_NAME=ossapp
      - SSH_PORT=2022
    restart: unless-stopped
    networks:
      - dev-network

volumes:
  ubuntu-dev-data:
  alpine-dev-data:
  multistage-dev-data:

networks:
  dev-network:
    driver: bridge
